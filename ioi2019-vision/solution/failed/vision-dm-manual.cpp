#include "vision.h"

using namespace std;

vector<vector<vector<vector<int>>>> layouts = {
    { // K = 1
        {
            {1, 1}
        },
        {
            {1},
            {1}
        },
        {
            {1, 1, 0}
        },
        {
            {1},
            {1},
            {0}
        },
        {
            {0, 1, 1}
        },
        {
            {0},
            {1},
            {1}
        },
        {
            {1, 1},
            {0, 0}
        },
        {
            {1, 0},
            {1, 0}
        },
        {
            {0, 0},
            {1, 1}
        },
        {
            {0, 1},
            {0, 1}
        },
        {
            {1, 1, 0},
            {0, 0, 0}
        },
        {
            {1, 0},
            {1, 0},
            {0, 0}
        },
        {
            {0, 1, 1},
            {0, 0, 0}
        },
        {
            {0, 0},
            {1, 0},
            {1, 0}
        },
        {
            {0, 0, 0},
            {1, 1, 0}
        },
        {
            {0, 1},
            {0, 1},
            {0, 0}
        },
        {
            {0, 0, 0},
            {0, 1, 1}
        },
        {
            {0, 0},
            {0, 1},
            {0, 1}
        },
        {
            {1, 1},
            {0, 0},
            {0, 0}
        },
        {
            {1, 0, 0},
            {1, 0, 0}
        },
        {
            {0, 0},
            {1, 1},
            {0, 0}
        },
        {
            {0, 1, 0},
            {0, 1, 0}
        },
        {
            {0, 0},
            {0, 0},
            {1, 1}
        },
        {
            {0, 0, 1},
            {0, 0, 1}
        },
        {
            {1, 1, 0},
            {0, 0, 0},
            {0, 0, 0}
        },
        {
            {1, 0, 0},
            {1, 0, 0},
            {0, 0, 0}
        },
        {
            {0, 1, 1},
            {0, 0, 0},
            {0, 0, 0}
        },
        {
            {0, 0, 0},
            {1, 0, 0},
            {1, 0, 0}
        },
        {
            {0, 0, 0},
            {1, 1, 0},
            {0, 0, 0}
        },
        {
            {0, 1, 0},
            {0, 1, 0},
            {0, 0, 0}
        },
        {
            {0, 0, 0},
            {0, 1, 1},
            {0, 0, 0}
        },
        {
            {0, 0, 0},
            {0, 1, 0},
            {0, 1, 0}
        },
        {
            {0, 0, 0},
            {0, 0, 0},
            {1, 1, 0}
        },
        {
            {0, 0, 1},
            {0, 0, 1},
            {0, 0, 0}
        },
        {
            {0, 0, 0},
            {0, 0, 0},
            {0, 1, 1}
        },
        {
            {0, 0, 0},
            {0, 0, 1},
            {0, 0, 1}
        }
    },
    { // K = 2
        {
            {1, 0, 1}
        },
        {
            {1},
            {0},
            {1}
        },
        {
            {1, 0},
            {0, 1}
        },
        {
            {0, 1},
            {1, 0}
        },
        {
            {1, 0, 1},
            {0, 0, 0}
        },
        {
            {1, 0},
            {0, 0},
            {1, 0}
        },
        {
            {1, 0, 0},
            {0, 1, 0}
        },
        {
            {1, 0},
            {0, 1},
            {0, 0}
        },
        {
            {0, 1, 0},
            {0, 0, 1}
        },
        {
            {0, 0},
            {1, 0},
            {0, 1}
        },
        {
            {0, 1, 0},
            {1, 0, 0}
        },
        {
            {0, 1},
            {1, 0},
            {0, 0}
        },
        {
            {0, 0, 1},
            {0, 1, 0}
        },
        {
            {0, 0},
            {0, 1},
            {1, 0}
        },
        {
            {0, 0, 0},
            {1, 0, 1}
        },
        {
            {0, 1},
            {0, 0},
            {0, 1}
        },
        {
            {1, 0, 1},
            {0, 0, 0},
            {0, 0, 0}
        },
        {
            {1, 0, 0},
            {0, 1, 0},
            {0, 0, 0}
        },
        {
            {1, 0, 0},
            {0, 0, 0},
            {1, 0, 0}
        },
        {
            {0, 1, 0},
            {1, 0, 0},
            {0, 0, 0}
        },
        {
            {0, 1, 0},
            {0, 0, 0},
            {0, 1, 0}
        },
        {
            {0, 1, 0},
            {0, 0, 1},
            {0, 0, 0}
        },
        {
            {0, 0, 1},
            {0, 1, 0},
            {0, 0, 0}
        },
        {
            {0, 0, 1},
            {0, 0, 0},
            {0, 0, 1}
        },
        {
            {0, 0, 0},
            {1, 0, 1},
            {0, 0, 0}
        },
        {
            {0, 0, 0},
            {1, 0, 0},
            {0, 1, 0}
        },
        {
            {0, 0, 0},
            {0, 1, 0},
            {0, 0, 1}
        },
        {
            {0, 0, 0},
            {0, 1, 0},
            {1, 0, 0}
        },
        {
            {0, 0, 0},
            {0, 0, 1},
            {0, 1, 0}
        },
        {
            {0, 0, 0},
            {0, 0, 0},
            {1, 0, 1}
        },
    },
    { // K = 3
        {
            {1, 0, 0},
            {0, 0, 1}
        },
        {
            {1, 0},
            {0, 0},
            {0, 1}
        },
        {
            {0, 0, 1},
            {1, 0, 0}
        },
        {
            {0, 1},
            {0, 0},
            {1, 0}
        },
        {
            {1, 0, 0},
            {0, 0, 1},
            {0, 0, 0}
        },
        {
            {1, 0, 0},
            {0, 0, 0},
            {0, 1, 0}
        },
        {
            {0, 1, 0},
            {0, 0, 0},
            {1, 0, 0}
        },
        {
            {0, 1, 0},
            {0, 0, 0},
            {0, 0, 1}
        },
        {
            {0, 0, 1},
            {1, 0, 0},
            {0, 0, 0}
        },
        {
            {0, 0, 1},
            {0, 0, 0},
            {0, 1, 0}
        },
        {
            {0, 0, 0},
            {1, 0, 0},
            {0, 0, 1}
        },
        {
            {0, 0, 0},
            {0, 0, 1},
            {1, 0, 0}
        }
    },
    { // K = 4
        {
            {1, 0, 0},
            {0, 0, 0},
            {0, 0, 1}
        },
        {
            {0, 0, 1},
            {0, 0, 0},
            {1, 0, 0}
        },
    }
};

void construct_network(int H, int W, int K)
{
    vector<int> global;
    for (auto &layout : layouts[K - 1])
    {
        if (layout.size() == H && layout[0].size() == W)
        {
            vector<int> gates;
            for (int y = 0; y < H; y++)
            {
                for (int x = 0; x < W; x++)
                {
                    int gate = y * W + x;
                    gates.push_back(layout[y][x] > 0 ? gate : add_not(gate));
                }
            }
            global.push_back(add_and(gates));
        }
    }
    add_or(global);
}